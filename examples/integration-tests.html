<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.7.1 at 2017-11-16 
 | Rendered using Apache Maven Fluido Skin 1.5
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Stephen Connolly" />
    <meta name="Date-Creation-yyyymmdd" content="20110117" />
    <meta name="Date-Revision-yyyymmdd" content="20171116" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Mojo's Cassandra Maven Plugin &#x2013; Integration tests</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.5.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido-1.5.min.js"></script>

                      </head>
        <body class="topBarDisabled">
          
    
    
            
    
        
    <a href="https://github.com/mojohaus/cassandra-maven-plugin">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                                  <a href="../../" id="bannerLeft">
                                                                                                <img src="../../images/mojo_logo.png"  alt="MojoHaus"/>
                </a>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
              
                              <li class="">
                    <a href="../../" title="MojoHaus">
        MojoHaus</a>
                    <span class="divider">/</span>
      </li>
            <li class="">
                    <a href="../../mojo-parent" title="MojoHaus Parent">
        MojoHaus Parent</a>
                    <span class="divider">/</span>
      </li>
            <li class="">
                    <a href="../index.html" title="Mojo's Cassandra Maven Plugin">
        Mojo's Cassandra Maven Plugin</a>
                    <span class="divider">/</span>
      </li>
        <li class="active ">Integration tests</li>
        
              
                  <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2017-11-16</li>
              <li id="projectVersion" class="pull-right">
                      <span class="divider">|</span>
                    Version: 3.6
        </li>
            
                                    
    <li class="pull-right">
                      <a href="http://maven.apache.org/" class="externalLink" title="Maven">
        Maven</a>
      </li>

                    </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
              
                <ul class="nav nav-list">
                    <li class="nav-header">Overview</li>
                              
      <li>
  
                          <a href="../index.html" title="Introduction">
          <span class="none"></span>
        Introduction</a>
            </li>
                
      <li>
  
                          <a href="../plugin-info.html" title="Goals">
          <span class="none"></span>
        Goals</a>
            </li>
                
      <li>
  
                          <a href="../usage.html" title="Usage">
          <span class="none"></span>
        Usage</a>
            </li>
                              <li class="nav-header">Examples</li>
                              
      <li>
  
                          <a href="../examples/developing-webapp.html" title="Developing a web application">
          <span class="none"></span>
        Developing a web application</a>
            </li>
                
      <li class="active">
  
            <a href="#"><span class="none"></span>Integration tests</a>
          </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                                        
      <li>
  
                          <a href="../project-info.html" title="Project Information">
          <span class="icon-chevron-right"></span>
        Project Information</a>
                  </li>
                                                                                                                                                                                                                                                                        
      <li>
  
                          <a href="../project-reports.html" title="Project Reports">
          <span class="icon-chevron-right"></span>
        Project Reports</a>
                  </li>
            </ul>
              
                            <form id="search-form" action="https://www.google.com/search" method="get" >
    
  <input value="www.mojohaus.org" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript" src="https://cse.google.com/brand?form=search-form"></script>
          
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span10" >
                                  
            <div class="section">
<h2><a name="Integration_tests"></a>Integration tests</h2>
<p>The aim here is to combine the usage of the <tt>cassandra-maven-plugin</tt> with the <tt>maven-failsafe-plugin</tt> to allow the integration tests to be run against a test instance of Apache Cassandra. The developer does not have to manually install Cassandra.</p>
<p>First we need to modify the <tt>pom.xml</tt> to reference both <tt>cassandra-maven-plugin</tt> and the <tt>maven-failsafe-plugin</tt></p>
<div>
<pre>&lt;project&gt;
  ...
  &lt;build&gt;
    ...
    &lt;plugins&gt;
      ...
      &lt;plugin&gt;
        &lt;artifactId&gt;maven-failsafe-plugin&lt;/artifactId&gt;
        &lt;version&gt;2.7.1&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;goals&gt;
              &lt;goal&gt;integration-test&lt;/goal&gt;
              &lt;goal&gt;verify&lt;/goal&gt;
            &lt;/goals&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
        &lt;artifactId&gt;cassandra-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;3.6&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;goals&gt;
              &lt;goal&gt;start&lt;/goal&gt;
              &lt;goal&gt;stop&lt;/goal&gt;
            &lt;/goals&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
      ...
    &lt;/plugins&gt;
    ...
  &lt;/build&gt;
  ...
&lt;/project&gt;</pre></div>
<p>This will result in the following mojos being executed during the lifecycle as follows:</p>
<table border="1" class="table table-striped">
<tr class="a">
<td align="left"><b>Phase</b></td>
<td align="left"><b>Goal(s)</b></td></tr>
<tr class="b">
<td align="left">pre-integration-test</td>
<td align="left">cassandra:start</td></tr>
<tr class="a">
<td align="left">integration-test</td>
<td align="left">failsafe:integration-test</td></tr>
<tr class="b">
<td align="left">post-integration-test</td>
<td align="left">cassandra:stop</td></tr>
<tr class="a">
<td align="left">verify</td>
<td align="left">failsafe:verify</td></tr></table>
<p>If you want the tests to be more independent, you can leverage the <tt>build-helper-maven-plugin</tt> to allocate random ports to your tests, thereby ensuring that the tests don't fail if a port is in use, and allowing, e.g. parallel builds on a build server.</p>
<p>For example (Note this example assumes you use resource filtering to pass the cassandra ports through to the tests, you could also pass them through as system properties by configuring <tt>maven-failsafe-plugin</tt>):</p>
<div>
<pre>&lt;project&gt;
  ...
  &lt;build&gt;
    ...
    &lt;plugins&gt;
      ...
      &lt;plugin&gt;
        &lt;artifactId&gt;build-helper-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;1.5&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;id&gt;reserve-network-port&lt;/id&gt;
            &lt;goals&gt;
              &lt;goal&gt;reserve-network-port&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;phase&gt;process-test-resources&lt;/phase&gt;
            &lt;configuration&gt;
              &lt;portNames&gt;
                &lt;portName&gt;cassandra.rpcPort&lt;/portName&gt;
                &lt;portName&gt;cassandra.jmxPort&lt;/portName&gt;
                &lt;portName&gt;cassandra.storagePort&lt;/portName&gt;
              &lt;/portNames&gt;
            &lt;/configuration&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
      &lt;plugin&gt;
        &lt;artifactId&gt;maven-failsafe-plugin&lt;/artifactId&gt;
        &lt;version&gt;2.7.1&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;goals&gt;
              &lt;goal&gt;integration-test&lt;/goal&gt;
              &lt;goal&gt;verify&lt;/goal&gt;
            &lt;/goals&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
        &lt;artifactId&gt;cassandra-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;3.6&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;goals&gt;
              &lt;goal&gt;start&lt;/goal&gt;
              &lt;goal&gt;stop&lt;/goal&gt;
            &lt;/goals&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
      ...
    &lt;/plugins&gt;
    ...
  &lt;/build&gt;
  ...
&lt;/project&gt;</pre></div>
<div class="section">
<h3><a name="Local_clusters"></a>Local clusters</h3>
<p>To use a local cluster, you just change the <tt>start</tt> and <tt>stop</tt> goals to <tt>start-cluster</tt> and <tt>stop-cluster</tt> respectively.</p>
<p>Note: On OS-X you will need to enable the local loop back aliases before you can run a cluster. One way to do this is to use the command</p>
<div>
<pre>ifconfig lo0 alias 127.0.0.2</pre></div>
<p>These aliases are not persisted across reboots.</p></div>
<div class="section">
<h3><a name="Port_usage"></a>Port usage</h3>
<p>As well as the standard Cassandra ports, the Maven plugin also opens a stop port (defaults to 8081) in order to allow the Cassandra service(s) to be shut down cleanly. If the default stop port is used by your tests, or is already in use on your system then you might need to change that default.</p>
<p>The best designed builds will use something like <a class="externalLink" href="http://mojo.codehaus.org/build-helper-maven-plugin/reserve-network-port-mojo.html">build-helper:reserve-network-port</a> to allocate ports.</p></div>
<div class="section">
<h3><a name="Trademarks"></a>Trademarks</h3>
<p>Apache, Apache Maven, Apache Cassandra, Maven, Cassandra and the Apache feather logo are trademarks of The Apache Software Foundation.</p></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                                      <p >Copyright &copy;                    2011&#x2013;2017
                        <a href="http://www.mojohaus.org">MojoHaus</a>.
            All rights reserved.    
      </p>
                </div>

        
          
    
    
                
    <div id="ohloh" class="pull-right">
      <script type="text/javascript" src="https://www.ohloh.net/p/5211/widgets/project_thin_badge.js"></script>
    </div>
        </div>
    </footer>
        </body>
</html>